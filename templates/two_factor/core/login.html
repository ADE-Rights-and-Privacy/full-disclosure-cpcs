{% extends "two_factor/_base_focus.html" %}
{% load i18n two_factor static fdp_extras %}

{% block extrastyle %}{{ block.super }}
{{ form.media }}
{% endblock %}



{% block content %}
  {% block title %}{% endblock %}

  {% if wizard.steps.current == 'auth' %}
  {% elif wizard.steps.current == 'token' %}
    {% if device.method == 'call' %}
      <p>{% blocktrans %}We are calling your phone right now, please enter the
        digits you hear.{% endblocktrans %}</p>
    {% elif device.method == 'sms' %}
      <p>{% blocktrans %}We sent you a text message, please enter the tokens we
        sent.{% endblocktrans %}</p>
    {% else %}
      <p>{% blocktrans %}Please enter the token displayed in your token generator app.{% endblocktrans %}</p>
    {% endif %}
  {% elif wizard.steps.current == 'backup' %}
    <p>{% blocktrans %}A backup token is a one-time-use token that was created by the FDP system.{% endblocktrans %}</p>
    <p>{% blocktrans %}It is different than the tokens generated by your token generator app.{% endblocktrans %}</p>
    <p>{% blocktrans %}Please enter a backup token.{% endblocktrans %}</p>
  {% endif %}

    <div id="content-main">
      <form action="" method="post">{% csrf_token %}

{% with has_extra_auth=is_extra_auth_installed has_password_reset=is_password_reset_configured %}

        {% if wizard.steps.current == 'auth' %}
          {% if has_extra_auth %}
            {% if form.non_field_errors %}
              <ul class="errorlist nonfield">
                <li>
                  {% trans 'Azure Active Directory users should use the' %}
                  <a href="{% url "social:begin" "azuread-tenant-oauth2" %}">Login as Azure Active Directory</a>
                  {% trans 'link below' %}
                </li>
              </ul>
            {% endif %}
          {% endif %}
        {% endif %}

        {% include "two_factor/_wizard_forms.html" %}

        {# hidden submit button to enable [enter] key #}
        <div class="hiddenenter"><input type="submit" value=""/></div>

        {% if other_devices %}
          <p>{% trans "Or, alternatively, use one of your backup phones:" %}</p>
          <p>
            {% for other in other_devices %}
            <button name="challenge_device" value="{{ other.persistent_id }}"
                    class="btn btn-default btn-block" type="submit">
              {{ other|device_action }}
            </button>
          {% endfor %}</p>
        {% endif %}

        {% include "two_factor/_wizard_actions.html" %}

        {% if wizard.steps.current == 'auth' %}
          <div class="belowlogin">
            {% if has_password_reset %}
            <a class="forgotpwd" href="{% url 'password_reset' %}">{% trans 'Forgot password?' %}</a>
            {% endif %}
            {% if has_extra_auth %}
            <a class="laslogin" href="{% url "social:begin" "azuread-tenant-oauth2" %}">Login with Active Directory</a>
            {% endif %}
            <div style="clear:both;"></div>
          </div>
        {% endif %}

        {% if backup_tokens %}
          <p class="back2falink">{% trans "If your token generator app is not available, you can use a backup token." %}</p>
          <div class="submit-row backuptoken">
            <button name="wizard_goto_step" type="submit" value="backup"
                    class="btn btn-default btn-block">{% trans "Use Backup Token" %}</button>
          </div>
        {% endif %}

{% endwith %}

      </form>
    </div>
{% endblock %}
